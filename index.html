<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>QuickSketch</title>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #111;
  color: white;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
}

.container {
  text-align: center;
  width: 95%;
  max-width: 750px;
}

h1 { margin-bottom: 20px; }

select, button {
  padding: 10px;
  margin: 8px;
  font-size: 16px;
  border-radius: 6px;
  border: none;
}

button {
  background: #4cafef;
  color: white;
  cursor: pointer;
}

button:disabled {
  background: gray;
  cursor: not-allowed;
}

#gameScreen { display: none; }

img {
  max-width: 100%;
  max-height: 65vh;
  border-radius: 10px;
  transition: opacity 0.3s ease;
  filter: grayscale(100%);
}

.timer { margin-top: 10px; font-size: 18px; }
.progress { margin-top: 5px; font-size: 14px; opacity: 0.8; }
.gameLength { margin-top: 10px; font-weight: bold; color: #4cafef; }

.subjects {
  margin-top: 15px;
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 8px;
  text-align: left;
}

.controls { margin-top: 15px; }
</style>
</head>

<body>
<div class="container">

<!-- SETTINGS -->
<div id="settingsScreen">
  <h1>QuickSketch</h1>

  <div>
    <label>Time Per Image:</label><br>
    <select id="timeSelect">
      <option value="">Select Time</option>
      <option value="15">15 Seconds</option>
      <option value="30">30 Seconds</option>
      <option value="60">1 Minute</option>
      <option value="120">2 Minutes</option>
    </select>
  </div>

  <div>
    <label>Number of Rounds:</label><br>
    <select id="quantitySelect">
      <option value="">Select Rounds</option>
      <option value="3">3 Rounds</option>
      <option value="6">6 Rounds</option>
      <option value="10">10 Rounds</option>
      <option value="15">15 Rounds</option>
    </select>
  </div>

  <div class="gameLength" id="gameLength"></div>

  <div class="subjects">
    <label><input type="checkbox" value="people"> People</label>
    <label><input type="checkbox" value="animals"> Animals</label>
    <label><input type="checkbox" value="objects"> Objects</label>
    <label><input type="checkbox" value="dinosaurs"> Dinosaurs</label>
    <label><input type="checkbox" value="robots"> Robots</label>
    <label><input type="checkbox" value="food"> Food</label>
    <label><input type="checkbox" value="toys"> Toys</label>
    <label><input type="checkbox" value="hands"> Hands</label>
    <label><input type="checkbox" value="architecture"> Architecture</label>
    <label><input type="checkbox" value="sports"> Sports</label>
  </div>

  <button id="startBtn" disabled>Start</button>
</div>

<!-- GAME -->
<div id="gameScreen">
  <img id="gameImage" src="">
  <div class="timer" id="countdown"></div>
  <div class="progress" id="progress"></div>

  <div class="controls">
    <button id="pauseBtn">Pause</button>
    <button id="resetBtn" style="display:none;">Reset</button>
  </div>
</div>

</div>

<script>
const ACCESS_KEY = "CYP2477i_ce6N6XIE7LgvynnIRbnhW0ALX9vbKAWB0w";

const timeSelect = document.getElementById("timeSelect");
const quantitySelect = document.getElementById("quantitySelect");
const startBtn = document.getElementById("startBtn");
const settingsScreen = document.getElementById("settingsScreen");
const gameScreen = document.getElementById("gameScreen");
const gameImage = document.getElementById("gameImage");
const countdown = document.getElementById("countdown");
const progress = document.getElementById("progress");
const pauseBtn = document.getElementById("pauseBtn");
const resetBtn = document.getElementById("resetBtn");
const gameLengthDisplay = document.getElementById("gameLength");
const subjectCheckboxes = document.querySelectorAll(".subjects input");

let selectedTime = 0;
let selectedQuantity = 0;
let selectedSubjects = [];
let currentImage = 0;
let timerInterval = null;
let timeLeft = 0;
let isPaused = false;
let preloadedImages = [];

/* ---------------- GAME LENGTH CALCULATION ---------------- */

function updateGameLength() {
  if (timeSelect.value && quantitySelect.value) {
    const totalSeconds = parseInt(timeSelect.value) * parseInt(quantitySelect.value);
    const minutes = Math.floor(totalSeconds / 60);
    const seconds = totalSeconds % 60;

    if (minutes > 0 && seconds > 0) {
      gameLengthDisplay.textContent = `Game Length = ${minutes}m ${seconds}s`;
    } else if (minutes > 0) {
      gameLengthDisplay.textContent = `Game Length = ${minutes} minute(s)`;
    } else {
      gameLengthDisplay.textContent = `Game Length = ${seconds} seconds`;
    }
  } else {
    gameLengthDisplay.textContent = "";
  }
}

/* ---------------- SELECTION CHECK ---------------- */

function checkSelections() {
  selectedSubjects = Array.from(subjectCheckboxes)
    .filter(cb => cb.checked)
    .map(cb => cb.value);

  startBtn.disabled = !(timeSelect.value && quantitySelect.value && selectedSubjects.length);
  updateGameLength();
}

timeSelect.addEventListener("change", checkSelections);
quantitySelect.addEventListener("change", checkSelections);
subjectCheckboxes.forEach(cb => cb.addEventListener("change", checkSelections));

/* ---------------- START GAME ---------------- */

startBtn.addEventListener("click", async () => {
  selectedTime = parseInt(timeSelect.value);
  selectedQuantity = parseInt(quantitySelect.value);

  await preloadImages();

  currentImage = 0;
  settingsScreen.style.display = "none";
  gameScreen.style.display = "block";
  showNextImage();
});

/* ---------------- IMAGE FETCHING (PRELOAD) ---------------- */

async function preloadImages() {
  preloadedImages = [];

  const queries = {
    people: "single person close up",
    animals: "animal close up",
    objects: "single object isolated",
    dinosaurs: "dinosaur realistic illustration single subject",
    robots: "robot single subject",
    food: "single food item isolated",
    toys: "single toy isolated",
    hands: "hand pose close up",
    architecture: "single building centered no people",
    sports: "single athlete action pose isolated"
  };

  for (let i = 0; i < selectedQuantity; i++) {
    const subject = selectedSubjects[Math.floor(Math.random() * selectedSubjects.length)];
    const query = encodeURIComponent(queries[subject]);
    const orientation = subject === "people" ? "portrait" : "landscape";

    const url = `https://api.unsplash.com/photos/random?query=${query}&orientation=${orientation}&content_filter=high&client_id=${ACCESS_KEY}`;

    try {
      const res = await fetch(url);
      const data = await res.json();
      if (data.urls) preloadedImages.push(data.urls.regular);
    } catch {}
  }
}

/* ---------------- IMAGE DISPLAY ---------------- */

function showNextImage() {
  if (currentImage >= preloadedImages.length) {
    endGame();
    return;
  }

  gameImage.src = preloadedImages[currentImage];
  currentImage++;
  progress.textContent = `Round ${currentImage} of ${selectedQuantity}`;

  timeLeft = selectedTime;
  startTimer();
}

/* ---------------- TIMER ---------------- */

function startTimer() {
  countdown.textContent = `Time Remaining: ${timeLeft}s`;

  timerInterval = setInterval(() => {
    if (!isPaused) {
      timeLeft--;
      countdown.textContent = `Time Remaining: ${timeLeft}s`;

      if (timeLeft <= 0) {
        clearInterval(timerInterval);
        showNextImage();
      }
    }
  }, 1000);
}

/* ---------------- PAUSE / RESET ---------------- */

pauseBtn.addEventListener("click", () => {
  if (!isPaused) {
    clearInterval(timerInterval);
    isPaused = true;
    pauseBtn.textContent = "Resume";
    resetBtn.style.display = "inline-block";
  } else {
    isPaused = false;
    pauseBtn.textContent = "Pause";
    resetBtn.style.display = "none";
    startTimer();
  }
});

resetBtn.addEventListener("click", resetGame);

function resetGame() {
  clearInterval(timerInterval);
  isPaused = false;
  gameScreen.style.display = "none";
  settingsScreen.style.display = "block";
  pauseBtn.textContent = "Pause";
  resetBtn.style.display = "none";
  countdown.textContent = "";
  progress.textContent = "";
  gameImage.src = "";
}

/* ---------------- END GAME ---------------- */

function endGame() {
  clearInterval(timerInterval);
  alert("Session Complete!");
  resetGame();
}
</script>

</body>
</html>
